---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";
---

<Layout title="Laboratorio SIM - Strumenti Avanzati">
    <div class="min-h-screen bg-gray-50 text-ink">
        <Navigation />

        <main class="lg:ml-64 p-4 md:p-8 lg:p-12">
            <!-- Header -->
            <header class="mb-12 border-b-4 border-ink pb-8">
                <span
                    class="font-mono text-xs font-bold uppercase tracking-widest text-gray-500 mb-2 block"
                    >/// Strumenti Pratici e Reali</span
                >
                <h1
                    class="font-sans font-black text-4xl md:text-6xl uppercase leading-none mb-4"
                >
                    Laboratorio <span class="text-accent">SIM</span>
                </h1>
                <p
                    class="font-serif text-xl md:text-2xl text-gray-600 max-w-3xl"
                >
                    Nessuna magia. Solo strumenti giusti per capire cosa non va.
                    <br />Usa questi tool, copia i risultati e avremo una base
                    solida su cui lavorare.
                </p>
            </header>

            <!-- TABS NAVIGATION -->
            <div class="mb-8 flex flex-wrap gap-4" role="tablist">
                <button
                    onclick="switchTab('diagnostica')"
                    id="tab-diagnostica"
                    class="tab-btn px-6 py-3 font-mono font-bold uppercase border-2 border-ink bg-ink text-white shadow-neo hover:translate-y-[-2px] transition-transform active:bg-accent active:text-ink"
                >
                    Diagnostica Guidata
                </button>
                <button
                    onclick="switchTab('comandi')"
                    id="tab-comandi"
                    class="tab-btn px-6 py-3 font-mono font-bold uppercase border-2 border-ink bg-white text-ink shadow-neo hover:translate-y-[-2px] transition-transform hover:bg-gray-100"
                >
                    Generatore Comandi
                </button>
                <button
                    onclick="switchTab('kit')"
                    id="tab-kit"
                    class="tab-btn px-6 py-3 font-mono font-bold uppercase border-2 border-ink bg-white text-ink shadow-neo hover:translate-y-[-2px] transition-transform hover:bg-gray-100"
                >
                    Kit Pronto Soccorso
                </button>
                <button
                    onclick="switchTab('demo')"
                    id="tab-demo"
                    class="tab-btn px-6 py-3 font-mono font-bold uppercase border-2 border-ink bg-white text-ink shadow-neo hover:translate-y-[-2px] transition-transform hover:bg-gray-100"
                >
                    Demo Web App
                </button>
            </div>

            <!-- SECTION 1: DIAGNOSTICA GUIDATA -->
            <section id="section-diagnostica" class="tab-content block">
                <div
                    class="bg-white border-2 border-ink p-6 md:p-8 shadow-neo-lg relative"
                >
                    <div
                        class="absolute top-0 right-0 bg-accent text-ink px-3 py-1 font-mono text-xs font-bold uppercase border-l-2 border-b-2 border-ink"
                    >
                        Wizard v1.0
                    </div>

                    <h2
                        class="font-black text-3xl uppercase mb-6 flex items-center gap-3"
                    >
                        <span class="text-4xl">ü©∫</span> Diagnostica Rapida
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- Sidebar Scelta Problema -->
                        <div
                            class="md:col-span-1 border-r-2 border-gray-200 pr-4 h-[600px] overflow-y-auto"
                        >
                            <h3
                                class="font-mono text-sm font-bold uppercase text-gray-500 mb-4"
                            >
                                Seleziona il problema:
                            </h3>
                            <div class="space-y-2" id="problem-list">
                                <!-- Populated via JS -->
                            </div>
                        </div>

                        <!-- Area Wizard -->
                        <div class="md:col-span-2 pl-4">
                            <div id="wizard-start" class="text-center py-20">
                                <p
                                    class="text-gray-400 text-xl font-serif italic"
                                >
                                    ‚Üê Seleziona un problema dalla lista per
                                    iniziare.
                                </p>
                            </div>

                            <div id="wizard-content" class="hidden">
                                <div
                                    class="flex justify-between items-center mb-6"
                                >
                                    <h3
                                        id="wizard-title"
                                        class="font-black text-2xl uppercase text-ink"
                                    >
                                    </h3>
                                    <span
                                        id="wizard-severity"
                                        class="px-3 py-1 rounded-full text-xs font-bold uppercase border border-ink"
                                    ></span>
                                </div>

                                <form id="wizard-form" class="space-y-6 mb-8">
                                    <!-- Questions injected here -->
                                </form>

                                <div
                                    class="bg-gray-50 p-6 border-2 border-dashed border-gray-300 rounded"
                                >
                                    <h4
                                        class="font-bold uppercase text-sm mb-2"
                                    >
                                        Risultato Diagnostico:
                                    </h4>
                                    <div
                                        id="wizard-output"
                                        class="font-mono text-sm bg-white p-4 border border-gray-200 mb-4 whitespace-pre-wrap min-h-[100px]"
                                    >
                                        In attesa di risposte...
                                    </div>
                                    <div class="flex flex-wrap gap-4">
                                        <button
                                            onclick="copyDiagnostic()"
                                            class="bg-ink text-white px-4 py-2 font-bold hover:bg-accent hover:text-ink transition-colors uppercase text-sm"
                                            >Copia Risultato</button
                                        >
                                        <button
                                            onclick="downloadDiagnostic()"
                                            class="bg-white border border-ink text-ink px-4 py-2 font-bold hover:bg-gray-100 transition-colors uppercase text-sm"
                                            >Scarica .txt</button
                                        >
                                    </div>
                                    <p
                                        class="mt-4 text-xs text-gray-500 italic"
                                    >
                                        üí° Suggerimento: Copia questo testo e
                                        mandamelo via email per un preventivo
                                        mirato.
                                        <a
                                            href="mailto:info@roccoandrealigorio.it"
                                            class="underline text-blue-600 font-bold ml-1"
                                            >info@roccoandrealigorio.it</a
                                        >
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 2: GENERATORE COMANDI -->
            <section id="section-comandi" class="tab-content hidden">
                <div
                    class="bg-white border-2 border-ink p-6 md:p-8 shadow-neo-lg"
                >
                    <h2
                        class="font-black text-3xl uppercase mb-2 flex items-center gap-3"
                    >
                        <span class="text-4xl">üíª</span> Generatore Comandi
                    </h2>
                    <p class="font-serif text-gray-600 mb-8 max-w-2xl">
                        Non ricordi mai la sintassi esatta? Ecco i comandi
                        pronti. Clicca "Copia", incollali nel terminale (CMD o
                        PowerShell) e guarda cosa succede.
                    </p>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <!-- Lista Comandi -->
                        <div
                            class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar"
                        >
                            <!-- Commands injected via JS -->
                            <div id="commands-list" class="space-y-4"></div>
                        </div>

                        <!-- Output Area (Opzionale per l'utente) -->
                        <div
                            class="bg-gray-900 p-6 rounded-lg text-green-400 font-mono text-sm relative border-4 border-gray-800 shadow-inner h-full min-h-[400px]"
                        >
                            <div
                                class="absolute top-0 left-0 w-full bg-gray-800 text-gray-400 px-4 py-2 text-xs flex justify-between items-center rounded-t-lg"
                            >
                                <span
                                    >TERMINALE (Preview / Incolla qui l'output
                                    se vuoi)</span
                                >
                                <div class="flex gap-2">
                                    <div
                                        class="w-3 h-3 rounded-full bg-red-500"
                                    >
                                    </div>
                                    <div
                                        class="w-3 h-3 rounded-full bg-yellow-500"
                                    >
                                    </div>
                                    <div
                                        class="w-3 h-3 rounded-full bg-green-500"
                                    >
                                    </div>
                                </div>
                            </div>
                            <textarea
                                id="terminal-paste-area"
                                class="w-full h-full bg-transparent border-none resize-none focus:outline-none mt-6 custom-scrollbar placeholder-gray-700"
                                placeholder="> Incolla qui l'output del comando per pulirlo o controllarlo..."
                            ></textarea>
                            <button
                                onclick="copyTerminal()"
                                class="absolute bottom-4 right-4 bg-green-600 text-white px-3 py-1 font-bold text-xs hover:bg-green-500 rounded uppercase"
                                >Copia Tutto</button
                            >
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: KIT PRONTO SOCCORSO -->
            <section id="section-kit" class="tab-content hidden">
                <div
                    class="bg-white border-2 border-ink p-6 md:p-8 shadow-neo-lg border-t-8 border-t-red-500"
                >
                    <h2
                        class="font-black text-3xl uppercase mb-6 flex items-center gap-3"
                    >
                        <span class="text-4xl">üíä</span> Kit Pronto Soccorso Digitale
                    </h2>
                    <p
                        class="font-serif text-gray-600 mb-8 max-w-2xl bg-yellow-50 p-4 border-l-4 border-yellow-400"
                    >
                        <strong>Disclaimer:</strong> Questi sono software di terze
                        parti, gratuiti e standard del settore. Usali a tuo rischio.
                        Se non sai cosa stai facendo, fermati e chiedi.
                    </p>

                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                        id="kit-grid"
                    >
                        <!-- Kit items injected via JS -->
                    </div>
                </div>
            </section>

            <!-- SECTION 4: DEMO WEB APP (Restored) -->
            <section id="section-demo" class="tab-content hidden">
                <div class="space-y-12">
                    <div
                        class="bg-gray-50 border-2 border-dashed border-gray-300 p-8 text-center mb-12"
                    >
                        <h2 class="font-black text-3xl uppercase mb-4">
                            Demo Web App
                        </h2>
                        <p
                            class="font-serif text-lg text-gray-600 max-w-2xl mx-auto"
                        >
                            Oltre ai tool di diagnostica, sviluppo applicazioni
                            web su misura per risolvere problemi aziendali
                            specifici. Ecco alcuni esempi di interfacce reali.
                        </p>
                    </div>

                    <!-- Demo 1 -->
                    <div
                        class="flex flex-col md:flex-row gap-8 items-center bg-white p-8 border-l-8 border-accent shadow-sm hover:shadow-md transition-shadow"
                    >
                        <div
                            class="w-full md:w-1/3 aspect-video bg-gray-100 border-2 border-ink overflow-hidden cursor-pointer group"
                            onclick="window.open('/tracker-demo.png', '_blank')"
                        >
                            <img
                                src="/tracker-demo.png"
                                alt="Tracker Interventi Dashboard"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform"
                            />
                        </div>
                        <div class="w-full md:w-2/3">
                            <h4 class="font-black text-2xl uppercase mb-2">
                                Tracker Interventi
                            </h4>
                            <p class="font-serif text-lg text-gray-600 mb-4">
                                Tieni traccia di chi fa cosa. Ideale per piccoli
                                team che si perdono i fogli di carta.
                            </p>
                            <ul
                                class="font-mono text-sm space-y-2 mb-6 text-gray-500"
                            >
                                <li>
                                    <strong>Cosa fa:</strong> Registra attivit√†, tempi
                                    e note tecniche.
                                </li>
                                <li>
                                    <strong>A chi serve:</strong> Artigiani, tecnici,
                                    piccole squadre.
                                </li>
                                <li>
                                    <strong>Vantaggio:</strong> Sai sempre cosa √®
                                    stato fatto e quando.
                                </li>
                            </ul>
                            <button
                                onclick="window.open('/tracker-demo.png', '_blank')"
                                class="bg-white border-2 border-ink px-4 py-2 font-bold uppercase hover:bg-ink hover:text-white transition-colors text-xs"
                                >Vedi Screenshot Full</button
                            >
                        </div>
                    </div>

                    <!-- Demo 2 -->
                    <div
                        class="flex flex-col md:flex-row gap-8 items-center bg-white p-8 border-l-8 border-ink shadow-sm hover:shadow-md transition-shadow"
                    >
                        <div
                            class="w-full md:w-1/3 aspect-video bg-gray-100 border-2 border-ink overflow-hidden cursor-pointer group"
                            onclick="window.open('/asset-demo.png', '_blank')"
                        >
                            <img
                                src="/asset-demo.png"
                                alt="Asset Manager Inventory"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform"
                            />
                        </div>
                        <div class="w-full md:w-2/3">
                            <h4 class="font-black text-2xl uppercase mb-2">
                                Gestione Asset IT (Light)
                            </h4>
                            <p class="font-serif text-lg text-gray-600 mb-4">
                                Sai quanti computer hai? Ti serve questo per
                                smettere di comprare toner per stampanti buttate
                                anni fa.
                            </p>
                            <ul
                                class="font-mono text-sm space-y-2 mb-6 text-gray-500"
                            >
                                <li>
                                    <strong>Cosa fa:</strong> Cataloga hardware e
                                    software in modo semplice.
                                </li>
                                <li>
                                    <strong>A chi serve:</strong> Uffici con pi√π di
                                    3 PC.
                                </li>
                            </ul>
                            <button
                                onclick="window.open('/asset-demo.png', '_blank')"
                                class="bg-white border-2 border-ink px-4 py-2 font-bold uppercase hover:bg-ink hover:text-white transition-colors text-xs"
                                >Vedi Screenshot Full</button
                            >
                        </div>
                    </div>

                    <!-- Demo 3 -->
                    <div
                        class="flex flex-col md:flex-row gap-8 items-center bg-white p-8 border-l-8 border-blue-500 shadow-sm hover:shadow-md transition-shadow"
                    >
                        <div
                            class="w-full md:w-1/3 aspect-video bg-gray-100 border-2 border-ink overflow-hidden cursor-pointer group"
                            onclick="window.open('/data-demo.png', '_blank')"
                        >
                            <img
                                src="/data-demo.png"
                                alt="Data Collection Form"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform"
                            />
                        </div>
                        <div class="w-full md:w-2/3">
                            <h4 class="font-black text-2xl uppercase mb-2">
                                Raccolta Dati + Export CSV
                            </h4>
                            <p class="font-serif text-lg text-gray-600 mb-4">
                                Raccogli dati sul campo da tablet/telefono e
                                scaricali in Excel. Basta foglietti volanti.
                            </p>
                            <ul
                                class="font-mono text-sm space-y-2 mb-6 text-gray-500"
                            >
                                <li>
                                    <strong>Cosa fa:</strong> Form digitali personalizzati
                                    con export immediato.
                                </li>
                                <li>
                                    <strong>A chi serve:</strong> Chi fa sopralluoghi,
                                    sondaggi o controlli qualit√†.
                                </li>
                            </ul>
                            <button
                                onclick="window.open('/data-demo.png', '_blank')"
                                class="bg-white border-2 border-ink px-4 py-2 font-bold uppercase hover:bg-ink hover:text-white transition-colors text-xs"
                                >Vedi Screenshot Full</button
                            >
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script is:inline>
        // --- DATA: DIAGNOSTICA ---
        const diagnosticData = [
            {
                id: "slow-pc",
                label: "PC Lento / Rallentato",
                severity: "Bassa",
                questions: [
                    {
                        id: "restart",
                        text: "Hai riavviato il PC nelle ultime 24 ore?",
                        type: "radio",
                    },
                    {
                        id: "updates",
                        text: "Ci sono aggiornamenti di Windows in sospeso?",
                        type: "radio",
                    },
                    {
                        id: "disk",
                        text: "Il disco C: √® quasi pieno (barra rossa)?",
                        type: "radio",
                    },
                    {
                        id: "startup",
                        text: "Hai molte app che si avviano da sole?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "crash",
                label: "PC si blocca o riavvia (BSOD)",
                severity: "Alta",
                questions: [
                    {
                        id: "bsod",
                        text: "Vedi una schermata blu con scritte bianche?",
                        type: "radio",
                    },
                    {
                        id: "heat",
                        text: "Il PC scotta al tatto o le ventole girano al massimo?",
                        type: "radio",
                    },
                    {
                        id: "new-hw",
                        text: "Hai collegato nuovi dispositivi USB recentemente?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "wifi",
                label: "Wi-Fi Instabile / Cade",
                severity: "Media",
                questions: [
                    {
                        id: "router",
                        text: "Hai riavviato il modem/router (spento per 60s)?",
                        type: "radio",
                    },
                    {
                        id: "distance",
                        text: "Il problema persiste anche stando vicino al router?",
                        type: "radio",
                    },
                    {
                        id: "device",
                        text: "Succede su tutti i dispositivi o solo su questo?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "updates",
                label: "Problemi post-aggiornamento Windows",
                severity: "Media",
                questions: [
                    {
                        id: "kb",
                        text: "Il PC si √® aggiornato oggi o ieri?",
                        type: "radio",
                    },
                    {
                        id: "error-msg",
                        text: "Vedi messaggi di errore specifici all'avvio?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "internet",
                label: "Internet Lento / DNS",
                severity: "Bassa",
                questions: [
                    {
                        id: "speedtest",
                        text: "Lo speedtest √® molto pi√π basso del solito?",
                        type: "radio",
                    },
                    {
                        id: "websites",
                        text: "Alcuni siti non si aprono proprio?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "email",
                label: "Email (Invio/Ricezione/Spazio)",
                severity: "Media",
                questions: [
                    {
                        id: "webmail",
                        text: "Dalla webmail (browser) funziona tutto?",
                        type: "radio",
                    },
                    {
                        id: "attachment",
                        text: "Stai inviando allegati pesanti (>10MB)?",
                        type: "radio",
                    },
                    {
                        id: "full",
                        text: "Hai ricevuto avvisi di casella piena?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "backup",
                label: "Backup Dati (Mai verificato)",
                severity: "Alta",
                questions: [
                    {
                        id: "external",
                        text: "Hai un disco esterno collegato?",
                        type: "radio",
                    },
                    {
                        id: "cloud",
                        text: "Usi un sistema cloud (Drive/Dropbox)?",
                        type: "radio",
                    },
                    {
                        id: "test",
                        text: "Hai mai provato ad aprire un file dal backup?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "disk-space",
                label: "Spazio Disco Insufficiente",
                severity: "Media",
                questions: [
                    {
                        id: "trash",
                        text: "Hai svuotato il cestino?",
                        type: "radio",
                    },
                    {
                        id: "downloads",
                        text: "La cartella Download √® piena di file vecchi?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "account",
                label: "Accesso / Password / Account",
                severity: "Alta",
                questions: [
                    {
                        id: "caps",
                        text: "Il tasto Bloc Maiusc √® attivo?",
                        type: "radio",
                    },
                    {
                        id: "keyboard",
                        text: "La tastiera scrive i caratteri giusti (prova su note)?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "printer",
                label: "Stampante non funziona",
                severity: "Bassa",
                questions: [
                    {
                        id: "cable",
                        text: "√à collegata (USB o Wi-Fi) e accesa?",
                        type: "radio",
                    },
                    {
                        id: "paper",
                        text: "C'√® carta e inchiostro?",
                        type: "radio",
                    },
                    {
                        id: "queue",
                        text: "C'√® una coda di stampa bloccata?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "cloud-sync",
                label: "Cloud Sync (OneDrive/Drive)",
                severity: "Media",
                questions: [
                    {
                        id: "icon",
                        text: "L'icona del cloud √® grigia o ha una X rossa?",
                        type: "radio",
                    },
                    {
                        id: "space",
                        text: "Lo spazio online √® esaurito?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "sw-license",
                label: "Software non parte / Licenze",
                severity: "Media",
                questions: [
                    {
                        id: "error",
                        text: "C'√® un messaggio di errore specifico?",
                        type: "radio",
                    },
                    {
                        id: "sub",
                        text: "L'abbonamento √® scaduto?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "app-slow",
                label: "Lentezza App Specifica",
                severity: "Bassa",
                questions: [
                    {
                        id: "update",
                        text: "L'app √® aggiornata all'ultima versione?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "security",
                label: "Sicurezza Base",
                severity: "Alta",
                questions: [
                    {
                        id: "antivirus",
                        text: "L'antivirus √® attivo e aggiornato?",
                        type: "radio",
                    },
                    {
                        id: "scan",
                        text: "Hai fatto una scansione completa recentemente?",
                        type: "radio",
                    },
                ],
            },
            {
                id: "corp-pc",
                label: "PC Aziendale (Permessi)",
                severity: "Alta",
                questions: [
                    {
                        id: "admin",
                        text: "Hai i permessi di amministratore?",
                        type: "radio",
                    },
                    {
                        id: "vpn",
                        text: "Sei connesso alla VPN aziendale?",
                        type: "radio",
                    },
                ],
            },
        ];

        // --- DATA: COMANDI ---
        const commandsData = [
            {
                cmd: "systeminfo",
                desc: "Mostra tutto sul tuo PC: data installazione Windows, modello, RAM, e uptime.",
                usage: "Utile per sapere esattamente che macchina hai davanti.",
            },
            {
                cmd: "ipconfig /all",
                desc: "Dettagli completi della rete. IP, MAC address, DNS.",
                usage: "Fondamentale per problemi di rete e Wi-Fi.",
            },
            {
                cmd: "ping 8.8.8.8",
                desc: "Controlla se raggiungi Google. Se fallisce, non hai internet.",
                usage: "Il test base di connettivit√†.",
            },
            {
                cmd: "tracert google.com",
                desc: "Mostra la strada che fanno i tuoi dati. Vedi dove si bloccano.",
                usage: "Per capire se √® colpa tua o del provider.",
            },
            {
                cmd: "nslookup google.com",
                desc: "Testa se il DNS funziona (traduce nomi in IP).",
                usage: "Se internet va ma i siti non si aprono.",
            },
            {
                cmd: "netstat -an",
                desc: "Vedi tutte le connessioni attive del tuo PC.",
                usage: "Per scovare spyware o connessioni sospette.",
            },
            {
                cmd: "tasklist",
                desc: "Elenco di tutti i processi attivi.",
                usage: "Come Gestione Attivit√†, ma testuale ed esportabile.",
            },
            {
                cmd: "wmic diskdrive get status",
                desc: "Chiede al disco fisso se sta bene (S.M.A.R.T.).",
                usage: "Risposta rapida: OK o Pred Fail (corri a fare backup!).",
            },
            {
                cmd: "chkdsk C: /scan",
                desc: "Scansiona il disco per errori senza riavviare.",
                usage: "Controllo salute file system.",
            },
            {
                cmd: "sfc /scannow",
                desc: "Ripara i file di sistema di Windows corrotti.",
                usage: 'Il "paracetamolo" di Windows: risolve tanti piccoli guai. (Richiede Admin)',
            },
            {
                cmd: "dism /online /cleanup-image /restorehealth",
                desc: "Ripara l'immagine di Windows usando Windows Update.",
                usage: "Se sfc fallisce, si usa questo. (Richiede Admin)",
            },
            {
                cmd: "powercfg /energy",
                desc: "Analizza l'efficienza energetica e la batteria.",
                usage: "Genera un report HTML dettagliato sul consumo.",
            },
            {
                cmd: 'wevtutil qe system /c:20 /f:text /q:"*[System[(Level=2)]]"',
                desc: "Legge gli ultimi 20 errori critici dal registro eventi.",
                usage: "Cosa √® successo prima del crash?",
            },
            {
                cmd: "net use",
                desc: "Mostra le cartelle di rete connesse.",
                usage: "Utile in azienda per problemi di accesso ai file condivisi.",
            },
            {
                cmd: "driverquery",
                desc: "Elenca tutti i driver installati.",
                usage: "Per capire se un driver specifico manca o √® vecchio.",
            },
        ];

        // --- DATA: KIT ---
        const kitData = [
            {
                category: "Hardware",
                items: [
                    {
                        name: "CrystalDiskInfo",
                        desc: "Controlla la salute del disco fisso (SMART).",
                        use: "Se il PC √® lento o fa rumori strani.",
                        caution: "Nessuna.",
                        link: "https://crystalmark.info/en/software/crystaldiskinfo/",
                    },
                    {
                        name: "HWMonitor",
                        desc: "Vedi temperature e voltaggi in tempo reale.",
                        use: "Se il PC si spegne da solo o le ventole urlano.",
                        caution: "Interpretare i dati richiede esperienza.",
                        link: "https://www.cpuid.com/softwares/hwmonitor.html",
                    },
                    {
                        name: "CPU-Z",
                        desc: "Dettagli su Processore, RAM e Scheda Madre.",
                        use: "Per sapere cosa comprare per l'upgrade.",
                        caution: "Nessuna.",
                        link: "https://www.cpuid.com/softwares/cpu-z.html",
                    },
                ],
            },
            {
                category: "Pulizia",
                items: [
                    {
                        name: "BleachBit",
                        desc: "Pulisce file inutili e cache (alternativa open a CCleaner).",
                        use: "Per liberare spazio disco.",
                        caution:
                            "Attento a non cancellare cookie/password salvate se ti servono.",
                        link: "https://www.bleachbit.org/",
                    },
                    {
                        name: "Autoruns",
                        desc: "Gestione avanzata avvio automatico.",
                        use: "Per rimuovere malware o bloatware che parte all'avvio.",
                        caution:
                            "PUOI ROMPERE WINDOWS. Disabilita solo ci√≤ che conosci.",
                        link: "https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns",
                    },
                ],
            },
            {
                category: "Sicurezza",
                items: [
                    {
                        name: "Malwarebytes",
                        desc: "Scanner anti-malware on-demand.",
                        use: "Se pensi di avere un virus.",
                        caution:
                            "La versione free va benissimo per scansioni manuali.",
                        link: "https://www.malwarebytes.com/",
                    },
                    {
                        name: "AdwCleaner",
                        desc: "Rimuove adware e toolbar fastidiose.",
                        use: "Se il browser apre pagine strane.",
                        caution: "Nessuna.",
                        link: "https://www.malwarebytes.com/adwcleaner",
                    },
                ],
            },
            {
                category: "Utility",
                items: [
                    {
                        name: "7-Zip",
                        desc: "Apre qualsiasi archivio compresso.",
                        use: "Sempre.",
                        caution: "Nessuna.",
                        link: "https://www.7-zip.org/",
                    },
                    {
                        name: "Everything",
                        desc: "Cerca file istantaneamente.",
                        use: "Quando Windows Search non trova nulla.",
                        caution: "Trova ANCHE i file di sistema nascosti.",
                        link: "https://www.voidtools.com/",
                    },
                ],
            },
        ];

        // --- LOGIC ---

        // Tabs
        function switchTab(tabId) {
            document
                .querySelectorAll(".tab-content")
                .forEach((el) => el.classList.add("hidden"));
            document
                .getElementById("section-" + tabId)
                .classList.remove("hidden");

            document.querySelectorAll(".tab-btn").forEach((el) => {
                el.classList.remove("bg-ink", "text-white");
                el.classList.add("bg-white", "text-ink");
            });
            const activeBtn = document.getElementById("tab-" + tabId);
            activeBtn.classList.remove("bg-white", "text-ink");
            activeBtn.classList.add("bg-ink", "text-white");
        }

        // Diagnostica init
        function initDiagnostica() {
            const list = document.getElementById("problem-list");
            list.innerHTML = "";
            diagnosticData.forEach((item) => {
                const btn = document.createElement("button");
                btn.className =
                    "w-full text-left p-3 hover:bg-gray-100 border-l-4 border-transparent hover:border-accent transition-all text-sm font-medium";
                btn.innerText = item.label;
                btn.onclick = () => loadWizard(item);
                list.appendChild(btn);
            });
        }

        let currentDiag = null;

        function loadWizard(item) {
            currentDiag = item;
            document.getElementById("wizard-start").classList.add("hidden");
            document
                .getElementById("wizard-content")
                .classList.remove("hidden");

            document.getElementById("wizard-title").innerText = item.label;
            const badge = document.getElementById("wizard-severity");
            badge.innerText = "Priorit√†: " + item.severity;
            badge.className =
                "px-3 py-1 rounded-full text-xs font-bold uppercase border border-ink text-white " +
                (item.severity === "Alta"
                    ? "bg-red-600"
                    : item.severity === "Media"
                      ? "bg-yellow-500 text-ink"
                      : "bg-green-600");

            const form = document.getElementById("wizard-form");
            form.innerHTML = "";

            item.questions.forEach((q, idx) => {
                const div = document.createElement("div");
                div.className = "bg-gray-50 p-4 rounded border border-gray-200";
                div.innerHTML = `
                <p class="font-bold mb-2 text-sm">${idx + 1}. ${q.text}</p>
                <div class="flex gap-4">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="${q.id}" value="S√¨" onchange="updateOutput()" class="accent-ink"> S√¨
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="${q.id}" value="No" onchange="updateOutput()" class="accent-ink"> No
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="${q.id}" value="Non so" onchange="updateOutput()" class="accent-ink"> Non so
                    </label>
                </div>
            `;
                form.appendChild(div);
            });
            updateOutput();
        }

        function updateOutput() {
            if (!currentDiag) return;
            const inputs = document.querySelectorAll(
                "#wizard-form input:checked",
            );
            let text = `DIAGNOSI GUIDATA - LABORATIORIO SIM\n`;
            text += `Problema: ${currentDiag.label} (Priorit√†: ${currentDiag.severity})\n`;
            text += `Data: ${new Date().toLocaleString()}\n\n`;
            text += `RISPOSTE:\n`;

            inputs.forEach((input) => {
                const qText = input
                    .closest("div")
                    .parentElement.querySelector("p").innerText;
                text += `- ${qText} -> ${input.value}\n`;
            });

            text += `\nCONSIGLIO AUTOMATICO:\n`;
            // Logica molto semplice per demo
            const yesCount = Array.from(inputs).filter(
                (i) => i.value === "S√¨",
            ).length;
            if (yesCount > 0) {
                text += `Hai risposto 'S√¨' ad alcune verifiche critiche. Questo indica un problema specifico gi√† isolato. `;
                if (currentDiag.severity === "Alta")
                    text += `Ti consiglio di spegnere il dispositivo e contattare l'assistenza.`;
                else
                    text += `Potrebbe essere risolvibile con una manutenzione standard.`;
            } else {
                text += `Le verifiche di base non hanno evidenziato cause ovvie. Serve un'analisi pi√π approfondita dei log.`;
            }

            document.getElementById("wizard-output").innerText = text;
        }

        function copyDiagnostic() {
            const text = document.getElementById("wizard-output").innerText;
            navigator.clipboard.writeText(text);
            alert("Diagnosi copiata negli appunti!");
        }

        function downloadDiagnostic() {
            const text = document.getElementById("wizard-output").innerText;
            const blob = new Blob([text], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `Diagnosi_${currentDiag.id}.txt`;
            a.click();
        }

        // Comandi init
        function initComandi() {
            const list = document.getElementById("commands-list");
            list.innerHTML = "";
            commandsData.forEach((cmd) => {
                const div = document.createElement("div");
                div.className =
                    "bg-gray-50 p-4 border-l-4 border-ink hover:bg-gray-100 transition-colors group";
                div.innerHTML = `
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div class="font-mono font-bold text-lg bg-gray-200 px-2 py-1 select-all">${cmd.cmd}</div>
                    <button onclick="copyCommand('${cmd.cmd}')" class="text-xs uppercase font-bold bg-white border border-gray-400 px-2 py-1 hover:bg-ink hover:text-white transition-colors">Copia</button>
                </div>
                <p class="text-sm font-bold mt-2 text-ink">${cmd.desc}</p>
                <p class="text-xs text-gray-500 italic mt-1 font-serif">${cmd.usage}</p>
            `;
                list.appendChild(div);
            });
        }

        function copyCommand(text) {
            navigator.clipboard.writeText(text);
            // Feedback visivo rapido pulsante/ui opzionale
        }

        function copyTerminal() {
            const text = document.getElementById("terminal-paste-area").value;
            if (!text) return;
            navigator.clipboard.writeText(text);
            alert("Contenuto terminale copiato!");
        }

        // Kit init
        function initKit() {
            const grid = document.getElementById("kit-grid");
            grid.innerHTML = "";
            kitData.forEach((cat) => {
                const col = document.createElement("div");
                col.className = "space-y-4";
                col.innerHTML = `<h3 class="font-black text-xl uppercase border-b-2 border-gray-300 pb-2">${cat.category}</h3>`;

                cat.items.forEach((tool) => {
                    const card = document.createElement("div");
                    card.className =
                        "bg-gray-50 p-4 border border-gray-200 hover:shadow-md transition-shadow relative";
                    card.innerHTML = `
                    <h4 class="font-bold text-lg text-ink mb-1 flex justify-between">
                        ${tool.name}
                        <a href="${tool.link}" target="_blank" class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200">WEB ‚Üó</a>
                    </h4>
                    <p class="text-sm font-medium mb-2">${tool.desc}</p>
                    <div class="text-xs text-gray-600 space-y-1 bg-white p-2 border border-gray-100">
                        <p><span class="font-bold text-green-700">‚úì QUANDO:</span> ${tool.use}</p>
                        ${tool.caution !== "Nessuna." ? `<p><span class="font-bold text-red-600">‚ö† CAUTELA:</span> ${tool.caution}</p>` : ""}
                    </div>
                `;
                    col.appendChild(card);
                });
                grid.appendChild(col);
            });
        }

        // Start
        initDiagnostica();
        initComandi();
        initKit();
    </script>
</Layout>
