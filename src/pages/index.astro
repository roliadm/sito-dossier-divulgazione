---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";
import NewsTicker from "../components/NewsTicker.astro";
import TerminalSOS from "../components/TerminalSOS.astro";
import BullshitDetector from "../components/BullshitDetector.astro";
import Footer from "../components/Footer.astro";

import { getCollection } from "astro:content";

const allArticles = await getCollection("articoli", ({ data }) => {
    if (import.meta.env.PROD) {
        return data.draft !== true && data.date <= new Date();
    }
    return true;
});
const sortedArticles = allArticles.sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
const latestArticleData = sortedArticles[0];

const latestArticle = {
    title: latestArticleData.data.title,
    slug: latestArticleData.slug,
    desc: latestArticleData.data.description,
    date: latestArticleData.data.date.toLocaleDateString("it-IT", {
        day: "numeric",
        month: "short",
        year: "numeric",
    }),
};
---

<Layout title="Protocollo Principale">
    <div class="min-h-screen">
        <Navigation />

        <main class="lg:ml-64 relative z-10">
            <NewsTicker
                items={[
                    "Windows 12 è un mito",
                    "Attenzione al phishing via SMS",
                    "Hai fatto il backup oggi?",
                ]}
            />

            <div class="p-6 md:p-12 lg:p-16 max-w-5xl mx-auto">
                <!-- Hero Header -->
                <header class="mb-16 relative">
                    <h1
                        class="font-sans font-black text-5xl md:text-7xl lg:text-7xl xl:text-8xl leading-[0.85] tracking-tighter uppercase mb-8 break-words text-chrome"
                    >
                        Divulgazione<br />
                        Informatica<br />
                        Umana<span class="text-accent">.</span>
                    </h1>
                    <div
                        class="max-w-xl text-lg md:text-xl font-serif text-gray-700 leading-relaxed border-l-4 border-accent pl-6"
                    >
                        <p>
                            La tecnologia spiegata senza termini
                            incomprensibili. Niente hype. Niente marketing. Solo
                            la cruda verità su come sopravvivere al mondo
                            digitale.
                        </p>
                    </div>

                    <!-- Stamp Decoration -->
                    <div
                        class="absolute top-0 right-0 hidden md:block opacity-80 rotate-12 pointer-events-none mix-blend-multiply"
                    >
                        <div
                            class="border-4 border-red-700 text-red-700 font-mono font-bold text-sm p-2 uppercase tracking-widest text-center shadow-sm rounded-sm"
                        >
                            <span class="block text-4xl mb-1">100%</span>
                            NO AI CONTENT
                        </div>
                    </div>
                </header>

                <!-- Featured Section: Protocollo Recente -->
                <!-- Featured Section: Protocollo Recente -->
                <div
                    class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-24 items-start"
                >
                    <!-- Side Widget Area (Now Left) -->
                    <div class="space-y-12 order-2 lg:order-1">
                        <!-- Bullshit Detector Example -->
                        <div>
                            <span
                                class="font-mono text-xs font-bold uppercase tracking-widest text-gray-500 mb-4 block"
                                >/// Stato del Settore</span
                            >
                            <BullshitDetector
                                level={92}
                                label="AI Marketing Hype"
                            />
                        </div>

                        <!-- Mini News -->
                        <div class="pt-6 border-t border-gray-200">
                            <div class="flex justify-between items-center mb-6">
                                <h3
                                    class="font-sans font-bold text-2xl uppercase text-chrome"
                                >
                                    Dispacci Esterni
                                </h3>
                                <a
                                    href="/news"
                                    class="font-mono text-xs text-accent hover:text-ink transition-colors"
                                    >Vedi Tutti</a
                                >
                            </div>
                            <ul class="space-y-4 font-mono text-sm">
                                <li class="flex gap-4 items-start">
                                    <span class="text-gray-400 font-bold"
                                        >10:42</span
                                    >
                                    <a
                                        href="#"
                                        class="hover:text-accent transition-colors block"
                                        >Nuova vulnerabilità zero-day in iOS.</a
                                    >
                                </li>
                                <li class="flex gap-4 items-start">
                                    <span class="text-gray-400 font-bold"
                                        >09:15</span
                                    >
                                    <a
                                        href="#"
                                        class="hover:text-accent transition-colors block"
                                        >Il cloud di Azure ha subito
                                        un'interruzione.</a
                                    >
                                </li>
                                <li class="flex gap-4 items-start">
                                    <span class="text-gray-400 font-bold"
                                        >Ieri</span
                                    >
                                    <a
                                        href="#"
                                        class="hover:text-accent transition-colors block"
                                        >Elon Musk annuncia l'ennesima cosa.</a
                                    >
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Main Article (Now Right) -->
                    <div class="order-1 lg:order-2 text-right">
                        <div class="flex justify-center mb-4">
                            <span
                                class="font-mono text-xs font-bold uppercase tracking-widest text-accent bg-ink text-white px-2 py-1"
                                >/// Ultimo Protocollo ///</span
                            >
                        </div>
                        <article
                            class="group relative card-ceramic p-8 hover:scale-[1.02] transition-all cursor-pointer text-right"
                        >
                            <h2
                                class="font-sans font-black text-4xl md:text-5xl uppercase leading-none mb-4 group-hover:text-accent bg-clip-text transition-colors"
                            >
                                {latestArticle.title}
                            </h2>
                            <p
                                class="font-serif text-lg text-gray-600 mb-6 ml-auto max-w-md"
                            >
                                {latestArticle.desc}
                            </p>
                            <div
                                class="flex justify-between items-end flex-row-reverse"
                            >
                                <span
                                    class="font-mono text-xs bg-gray-200 text-ink px-2 py-1 rounded-sm shadow-inner"
                                    >{latestArticle.date}</span
                                >
                                <span
                                    class="font-mono font-bold text-accent group-hover:-translate-x-2 transition-transform"
                                    >← LEGGI IL FASCICOLO</span
                                >
                            </div>
                            <a
                                href={`/articoli/${latestArticle.slug}`}
                                class="absolute inset-0 z-10"></a>
                        </article>
                    </div>
                </div>

                <!-- Footer -->
                <Footer />
            </div>
        </main>
    </div>
    <TerminalSOS />
</Layout>
