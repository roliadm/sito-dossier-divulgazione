---
import Layout from "../../layouts/Layout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";
import { getCollection } from "astro:content";

const posts = (
    await getCollection("articoli", ({ data }) => {
        if (import.meta.env.PROD) {
            return data.draft !== true && data.date <= new Date();
        }
        return true;
    })
).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<Layout title="Archivio Protocolli">
    <Navigation />

    <div class="min-h-screen bg-slate-50 flex flex-col">
        <main class="flex-grow w-full max-w-5xl mx-auto px-4 py-12 md:py-20">
            <header class="mb-16 text-center max-w-3xl mx-auto">
                <span
                    class="text-xs font-bold uppercase tracking-widest text-slate-500 mb-2 block"
                >
                    /// Archivio Digitale
                </span>
                <h1
                    class="font-bold text-4xl md:text-6xl text-slate-900 mb-6 tracking-tight"
                >
                    Articoli & Guide
                </h1>
                <p class="text-xl text-slate-600 leading-relaxed">
                    Procedure operative, analisi tecniche e soluzioni a problemi
                    comuni, spiegate senza filtri.
                </p>
            </header>

            <div class="grid gap-8">
                {
                    posts.length === 0 && (
                        <div class="p-8 text-center bg-white border border-dashed border-slate-300 rounded-xl text-slate-500">
                            Nessun articolo trovato in archivio.
                        </div>
                    )
                }

                {
                    posts.map((post) => (
                        <article class="bg-white rounded-xl border border-slate-200 p-8 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all duration-300 group">
                            <div class="flex flex-col md:flex-row gap-6 md:items-baseline">
                                <div class="md:w-48 flex-shrink-0">
                                    <span class="text-sm font-bold text-slate-400 uppercase tracking-wide">
                                        {post.data.date.toLocaleDateString(
                                            "it-IT",
                                            {
                                                year: "numeric",
                                                month: "long",
                                                day: "numeric",
                                            },
                                        )}
                                    </span>
                                    <span class="block text-xs font-bold text-blue-600 uppercase mt-1">
                                        {post.data.category}
                                    </span>
                                </div>

                                <div class="flex-grow">
                                    <h2 class="font-bold text-2xl md:text-3xl text-slate-900 mb-4 group-hover:text-blue-600 transition-colors">
                                        <a
                                            href={`/articoli/${post.slug}`}
                                            class="block"
                                        >
                                            {post.data.title}
                                        </a>
                                    </h2>
                                    <p class="text-slate-600 text-lg leading-relaxed mb-6">
                                        {post.data.description}
                                    </p>
                                    <a
                                        href={`/articoli/${post.slug}`}
                                        class="inline-flex items-center text-sm font-bold text-blue-600 hover:text-blue-800 uppercase tracking-wide"
                                    >
                                        Leggi Tutto <span class="ml-1">â†’</span>
                                    </a>
                                </div>
                            </div>
                        </article>
                    ))
                }
            </div>
        </main>

        <Footer />
    </div>
</Layout>
