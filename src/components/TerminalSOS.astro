---
---
<div class="fixed bottom-6 right-6 z-[60]">
    <button id="sos-open" class="group bg-alert text-white font-mono font-bold text-sm px-6 py-3 border-4 border-ink shadow-neo hover:translate-y-[4px] hover:shadow-neo-sm transition-all flex items-center gap-2">
        <span class="animate-pulse">●</span> CANALE SOS
    </button>
</div>

<div id="terminal-overlay" class="fixed inset-0 bg-black/80 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="w-full max-w-2xl bg-black border-4 border-gray-600 shadow-2xl relative overflow-hidden h-[500px] flex flex-col font-mono text-green-500 text-sm md:text-base">
        
        <!-- CRT Effect Layers -->
        <div class="absolute inset-0 pointer-events-none bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,6px_100%] z-10 opacity-20"></div>
        <div class="absolute inset-0 bg-green-500/5 animate-pulse pointer-events-none z-10"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle,rgba(0,0,0,0)_0%,rgba(0,0,0,0.5)_100%)] pointer-events-none z-10"></div>

        <!-- Terminal Header -->
        <div class="flex justify-between items-center bg-gray-900 border-b border-gray-700 p-2 z-20">
            <span class="text-xs uppercase tracking-widest text-gray-400">RoccoOS SafeMode</span>
            <button id="sos-close" class="text-red-500 hover:bg-red-900/30 px-2 py-0.5 border border-transparent hover:border-red-500 transition-colors">[ CHIUDI ]</button>
        </div>

        <!-- Terminal Body -->
        <div id="terminal-body" class="flex-1 overflow-y-auto p-4 z-20 space-y-2 scrollbar-hide">
            <p>> Connecting to secure server...</p>
            <p>> <span class="text-white">Connection Established.</span></p>
            <p class="mb-4">
                Benvenuto nel Terminale di Emergenza.<br/>
                Qui puoi segnalare problemi, richiedere argomenti o semplicemente salutare.<br/>
                Scrivi <span class="text-white bg-green-900/50 px-1">help</span> per la lista comandi.
            </p>
        </div>

        <!-- Terminal Input -->
        <div class="p-4 bg-gray-900/50 border-t border-gray-700 z-20 flex gap-2">
            <span class="text-green-500 font-bold">></span>
            <input type="text" id="terminal-input" class="bg-transparent border-none outline-none flex-1 text-green-400 font-bold placeholder-green-900" placeholder="Scrivi qui..." autocomplete="off">
        </div>
    </div>
</div>

<script>
    const overlay = document.getElementById('terminal-overlay');
    const openBtn = document.getElementById('sos-open');
    const closeBtn = document.getElementById('sos-close');
    const input = document.getElementById('terminal-input') as HTMLInputElement;
    const body = document.getElementById('terminal-body');

    openBtn?.addEventListener('click', () => {
        overlay?.classList.remove('hidden');
        input?.focus();
    });

    closeBtn?.addEventListener('click', () => {
        overlay?.classList.add('hidden');
    });

    input?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const cmd = input.value.trim().toLowerCase();
            const originalCmd = input.value;
            input.value = '';
            
            printLine(`> ${originalCmd}`, 'text-white');
            
            processCommand(cmd);
        }
    });

    function printLine(text: string, className = '') {
        if(!body) return;
        const p = document.createElement('p');
        p.className = className;
        p.innerHTML = text; // Allow HTML
        body.appendChild(p);
        body.scrollTop = body.scrollHeight;
    }

    function processCommand(cmd: string) {
        switch(cmd) {
            case 'help':
                printLine('COMANDI DISPONIBILI:');
                printLine('- <span class="text-white">news</span>: Leggi ultimi titoli');
                printLine('- <span class="text-white">contatto</span>: Mostra email');
                printLine('- <span class="text-white">sos [messaggio]</span>: Invia un messaggio rapido (simulato)');
                printLine('- <span class="text-white">clear</span>: Pulisci schermo');
                break;
            case 'news':
                printLine('Recupero feed in corso...');
                setTimeout(() => {
                    printLine('1. Perché il Wi-Fi è lento? (Protocollo 04)', 'text-yellow-400');
                    printLine('2. Windows 12 non esiste. (News)', 'text-yellow-400');
                }, 500);
                break;
            case 'contatto':
                printLine('Email di servizio: rocco@esempio.it');
                break;
            case 'clear':
                if(body) body.innerHTML = '';
                break;
            default:
                if (cmd.startsWith('sos ')) {
                    printLine('Invio segnalazione al server centrale...', 'animate-pulse');
                    setTimeout(() => {
                        printLine('✅ Messaggio ricevuto. Grazie soldato.');
                    }, 1000);
                } else {
                    printLine(`Comando non riconosciuto: '${cmd}'. Scrivi 'help'.`, 'text-red-400');
                }
        }
    }
</script>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>
